using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;


/****************************************************************************/
///  PlagueEngine.TimeControlSystem
/****************************************************************************/
namespace PlagueEngine.TimeControlSystem
{

    /****************************************************************************/
    /// FrameCounter
    /****************************************************************************/
    class FrameCounter
    {

        /****************************************************************************/
        /// Delegate
        /****************************************************************************/
        public delegate void CallbackDelegate();

        /****************************************************************************/




        /****************************************************************************/
        /// Fields
        /****************************************************************************/
        private int totalFrames = 0;
        private int frameAlarm = 0;
        private CallbackDelegate callBackDelegate = null;
        private int repeats=0;
        private uint id=0;
        private static uint totalId = 0;
        private bool wasted=false;

        /****************************************************************************/


        /****************************************************************************/
        /// Constructor
        /****************************************************************************/
        public FrameCounter(int framesToAlarm, int repeats, CallbackDelegate callback)
        {
            this.id = ++totalId;
            this.callBackDelegate = callback;
            this.repeats = repeats;
            this.frameAlarm = framesToAlarm;
        }
        /****************************************************************************/




        /****************************************************************************/
        /// Update
        /****************************************************************************/
        public void Update()
        {
            if(wasted)return;

            totalFrames++;

            if (totalFrames % frameAlarm ==0)
            {
                if (repeats > 0) --repeats;
                if (repeats == 0) wasted = true;

                callBackDelegate();
            }
        }
        /****************************************************************************/





        /****************************************************************************/
        /// Wasted
        /****************************************************************************/
        public bool Wasted
        {
            get
            {
                return wasted;
            }
        }
        /****************************************************************************/


        /****************************************************************************/
        /// ID
        /****************************************************************************/
        public uint ID
        {
            get
            {
                return id;
            }
        }
        /****************************************************************************/


    }
    /****************************************************************************/


}
/****************************************************************************/
